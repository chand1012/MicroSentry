<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <title>Turret</title>
    </head>
    <script type="text/javascript">
        //needs rewritten for sentryWaitXTrig
        var xpos = 90;
        var trig = 0;
        var sendstring = "";
        var lasttime = 0;
        function doWork(trigstring, event){
            console.log(trigstring);
            $.post("/postrequest", {"byte":trigstring});
            if (event!=="undefined") {
                event.preventDefault();
            }
        }
        function genSend(){
            if (xpos<100){
                return "0"+xpos.toString()+trig.toString();
            } else {
                return xpos.toString()+trig.toString();
            }
        }
        function epochTime(){
            let dt = new Date();
            return dt.getTime();
        }
        // the part after && can be simplified
        window.addEventListener('keydown', function(event){
            if (event.keyCode == 37 && xpos<=180 && lasttime<=epochTime()) { // left
                lasttime = epochTime() + 1;
                xpos += 5;
            } else if (event.keyCode == 39 && xpos>=0 && lasttime<=epochTime()) { // right
                lasttime = epochTime() + 1;
                xpos -= 5;
            } else if (event.keyCode == 32){
                trig = 1;
            }
            sendstring = genSend();
            doWork(sendstring, event);
        });
        window.addEventListener('keyup', function(event){
            if (event.keyCode == 32){
                trig = 0;
            }
            sendstring = genSend();
            doWork(sendstring, event);
        });
        console.log("Script Loaded.");
    </script>
    
</html>